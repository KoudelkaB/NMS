<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ověření emailu - NMS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            text-align: center;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success {
            color: #4CAF50;
        }
        .error {
            color: #f44336;
        }
        .loading {
            color: #2196F3;
        }
        button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background-color: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ověření emailu</h1>
        <div id="status" class="loading">Ověřujeme váš email...</div>
        <div id="actions" style="display: none;">
            <button onclick="resendVerification()">Zkusit ověřit email znovu</button>
            <p id="error-message"></p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, applyActionCode, sendEmailVerification } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCGRj1DBJbWX-qRHkyCiVFoUNMNDrRK6gA",
            authDomain: "nms-dev-koudelkab.firebaseapp.com",
            projectId: "nms-dev-koudelkab",
            storageBucket: "nms-dev-koudelkab.firebasestorage.app",
            messagingSenderId: "769568338259",
            appId: "1:769568338259:web:2489f6cdb1831d1445f1a6"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Get the action code from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const actionCode = urlParams.get('oobCode');
        const mode = urlParams.get('mode');

        if (mode === 'verifyEmail' && actionCode) {
            applyActionCode(auth, actionCode)
                .then(() => {
                    document.getElementById('status').innerHTML = '<div class="success">Váš email byl úspěšně ověřen!</div>';
                    document.getElementById('status').className = 'success';
                    // Redirect to app after 3 seconds
                    setTimeout(() => {
                        window.location.href = 'https://nms-app.web.app'; // Replace with your app URL
                    }, 3000);
                })
                .catch((error) => {
                    console.error('Error verifying email:', error);
                    let errorMessage = 'Došlo k chybě při ověření emailu.';

                    if (error.code === 'auth/expired-action-code') {
                        errorMessage = 'Vaše žádost o ověření emailu vypršela nebo byl odkaz již použit.';
                    } else if (error.code === 'auth/invalid-action-code') {
                        errorMessage = 'Neplatný ověřovací odkaz.';
                    } else if (error.code === 'auth/user-disabled') {
                        errorMessage = 'Tento účet byl deaktivován.';
                    }

                    document.getElementById('status').innerHTML = '<div class="error">' + errorMessage + '</div>';
                    document.getElementById('status').className = 'error';
                    document.getElementById('actions').style.display = 'block';
                });
        } else {
            document.getElementById('status').innerHTML = '<div class="error">Neplatný ověřovací odkaz.</div>';
            document.getElementById('status').className = 'error';
        }

        window.resendVerification = function() {
            const user = auth.currentUser;
            if (user && !user.emailVerified) {
                sendEmailVerification(user)
                    .then(() => {
                        document.getElementById('error-message').innerHTML = 'Nový ověřovací email byl odeslán.';
                        document.getElementById('error-message').style.color = '#4CAF50';
                    })
                    .catch((error) => {
                        document.getElementById('error-message').innerHTML = 'Nelze odeslat ověřovací email: ' + error.message;
                        document.getElementById('error-message').style.color = '#f44336';
                    });
            } else {
                document.getElementById('error-message').innerHTML = 'Není přihlášen žádný uživatel nebo je email již ověřen.';
                document.getElementById('error-message').style.color = '#f44336';
            }
        };
    </script>
</body>
</html>